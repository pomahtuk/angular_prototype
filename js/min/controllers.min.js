(function(){"use strict";var e,t,i;$.fn.refresh=function(){return $(this.selector)},$.fn.isEmpty=function(){return 0===this.length},t=function(e){var t,i;return e=$(e),i=e.offset().top,t=function(){return i<$(this).offset().top},$.merge(e,e.nextUntil(t)).last()},e=function(e,t){return e.length>0&&t.length>0&&e.offset().top===t.offset().top},i=function(e,t,i,r){var n,a,u,s,o,c;return c=$(window).innerWidth(),s=t+i,o=c-2*r+i,a=Math.floor(o/s),n=c-(a*s-i),u=Math.floor(n/2),e.css({"margin-right":0,"margin-left":i}),e.each(function(e){return 0===e%a?$(this).css({"margin-left":u}):void 0})},this.gon={google_api_key:"AIzaSyCPyGutBfuX48M72FKpF4X_CxxPadq6r4w",acceptable_extensions:{audio:["mp3","ogg","aac","wav","amr","3ga","m4a","wma","mp4","mp2","flac"],image:["jpg","jpeg","gif","png","tiff","bmp"],video:["mp4","m4v"]},development:!1},angular.module("Museum.controllers",[]).controller("IndexController",["$scope","$http","$filter","$window","$modal","storage","$routeParams","ngProgress",function(r,n,a,u,s,o,c,l){var d,m,_,f,p,b,g,h,v,x,y,z,w,q;if(window.sc=r,r.exhibit_search="",r.criteriaMatch=function(e){return function(t){var i;return t.stories[r.current_museum.language].name?(i=t.stories[r.current_museum.language].name.toLowerCase().indexOf(e.toLowerCase())>-1,r.grid(),i||""===e):!0}},y=null!=c.museum_id?c.museum_id:"52485ff1da0484df71000002",d=null!=c.content_provider_id?c.content_provider_id:"52485ff1da0484df71000001",r.backend_url="http://192.168.216.128:3000",r.sort_field="number",r.sort_direction=1,r.sort_text="Sort 0-9",r.ajax_progress=!0,r.reload_exhibits=function(e,t){return l.color("#fd6e3b"),l.start(),n.get(""+r.backend_url+"/provider/"+d+"/museums/"+y+"/exhibits/"+e+"/"+t).success(function(e){var t,i,n,a,u,s,o,c,d;for(i=[],u=0,o=e.length;o>u;u++){for(n=e[u],t=n.exhibit,t.images=n.images,t.stories={},d=n.stories,s=0,c=d.length;c>s;s++)a=d[s],a.story.quiz=a.quiz.quiz,a.story.quiz.answers=a.quiz.answers,t.stories[a.story.language]=a.story;i.push(t)}return l.complete(),r.exhibits=i,r.active_exhibit=r.exhibits[0],r.ajax_progress=!1})},r.reload_exhibits(r.sort_field,r.sort_direction),r.museums=[{name:"Imperial Peace Museum",packege_status:"generated",city:"London",image:"/img/museum.jpg",type:"museum"},{name:"Imperial War Museum",packege_status:"generated",city:"Tokio",image:"/img/museum.jpg",type:"museum"},{name:"Imperial Peace Exhibitin",packege_status:"generated",city:"Moscow",image:"/img/museum.jpg",type:"museum"},{name:"Imperial War Exhibitin",packege_status:"generated",city:"Berlin",image:"/img/museum.jpg",type:"museum"},{name:"Republican Peace Museum",packege_status:"process",city:"Tokio",image:"/img/museum.jpg",type:"tour"},{name:"Republican Peace Exhibitin",packege_status:"process",city:"London",image:"/img/museum.jpg",type:"tour"},{name:"Republican War Museum",packege_status:"process",city:"Berlin",image:"/img/museum.jpg",type:"tour"},{name:"Republican War Exhibitin",packege_status:"process",city:"London",image:"/img/museum.jpg",type:"museum"}],r.user={mail:"pman89@yandex.ru",providers:[{name:"IZI.travel Test Provider"},{name:"IZI.travel Second Provider"}]},r.provider={name:"content_1",id:"1",passcode:"passcode",passcode_edit_link:"/1/pass/edit/"},r.translations={ru:"Russian",en:"English",es:"Spanish"},o.bind(r,"exhibits",{defaultValue:[{index:0,name:"Богоматерь Владимирская, с двунадесятыми праздниками",number:"1",image:"http://media.izi.travel/fc85dcc2-3e95-40a9-9a78-14705a106230/14845c98-05ec-4da8-8aff-11808ecc123f_800x600.jpg",thumb:"http://media.izi.travel/fc85dcc2-3e95-40a9-9a78-14705a106230/7104d8b7-2f73-4b98-bfb2-b4245a325ce3_480x360.jpg",publish_state:"all",description:"",qr_code:{url:"/img/qr_code.png",print_link:"http://localhost:8000/img/qr_code.png"},images:[{image:"http://media.izi.travel/fc85dcc2-3e95-40a9-9a78-14705a106230/14845c98-05ec-4da8-8aff-11808ecc123f_800x600.jpg",thumb:"http://media.izi.travel/fc85dcc2-3e95-40a9-9a78-14705a106230/7104d8b7-2f73-4b98-bfb2-b4245a325ce3_480x360.jpg",id:1,edit_url:"http://media.izi.travel/fc85dcc2-3e95-40a9-9a78-14705a106230/7104d8b7-2f73-4b98-bfb2-b4245a325ce3_480x360.jpg"},{image:"http://media.izi.travel/fc85dcc2-3e95-40a9-9a78-14705a106230/14845c98-05ec-4da8-8aff-11808ecc123f_800x600.jpg",thumb:"http://media.izi.travel/fc85dcc2-3e95-40a9-9a78-14705a106230/7104d8b7-2f73-4b98-bfb2-b4245a325ce3_480x360.jpg",id:2,edit_url:"http://media.izi.travel/fc85dcc2-3e95-40a9-9a78-14705a106230/7104d8b7-2f73-4b98-bfb2-b4245a325ce3_480x360.jpg"}],stories:{ru:{name:"Богоматерь Владимирская, с двунадесятыми праздниками",description:"test description",publish_state:"all",audio:"http://www.jplayer.org/audio/ogg/TSP-01-Cro_magnon_man.ogg",quiz:{question:"are you sure?",description:"can you tell me?",state:"published",answers:[{title:"yes",correct:!1,id:0},{title:"may be",correct:!0,id:1},{title:"who cares?",correct:!1,id:2},{title:"nope",correct:!1,id:3}]}}}},{index:1,name:"двунадесятыми праздниками",number:"2",image:"http://media.izi.travel/fc85dcc2-3e95-40a9-9a78-14705a106230/14845c98-05ec-4da8-8aff-11808ecc123f_800x600.jpg",thumb:"http://media.izi.travel/fc85dcc2-3e95-40a9-9a78-14705a106230/7104d8b7-2f73-4b98-bfb2-b4245a325ce3_480x360.jpg",publish_state:"all",description:"",qr_code:{url:"/img/qr_code.png",print_link:"http://localhost:8000/img/qr_code.png"},images:[{image:"http://media.izi.travel/fc85dcc2-3e95-40a9-9a78-14705a106230/14845c98-05ec-4da8-8aff-11808ecc123f_800x600.jpg",thumb:"http://media.izi.travel/fc85dcc2-3e95-40a9-9a78-14705a106230/7104d8b7-2f73-4b98-bfb2-b4245a325ce3_480x360.jpg",id:1,edit_url:"http://media.izi.travel/fc85dcc2-3e95-40a9-9a78-14705a106230/7104d8b7-2f73-4b98-bfb2-b4245a325ce3_480x360.jpg"},{image:"http://media.izi.travel/fc85dcc2-3e95-40a9-9a78-14705a106230/14845c98-05ec-4da8-8aff-11808ecc123f_800x600.jpg",thumb:"http://media.izi.travel/fc85dcc2-3e95-40a9-9a78-14705a106230/7104d8b7-2f73-4b98-bfb2-b4245a325ce3_480x360.jpg",id:2,edit_url:"http://media.izi.travel/fc85dcc2-3e95-40a9-9a78-14705a106230/7104d8b7-2f73-4b98-bfb2-b4245a325ce3_480x360.jpg"}],stories:{ru:{name:"Богоматерь Владимирская, с двунадесятыми праздниками",description:"test description",audio:"",publish_state:"all",quiz:{question:"are you sure?",description:"can you tell me?",state:"published",answers:[{title:"yes",correct:!1,id:0},{title:"may be",correct:!0,id:1},{title:"who cares?",correct:!1,id:2},{title:"nope",correct:!1,id:3}]}}}},{index:2,name:"Владимирская, с двунадесятыми",number:"3",image:"http://media.izi.travel/fc85dcc2-3e95-40a9-9a78-14705a106230/14845c98-05ec-4da8-8aff-11808ecc123f_800x600.jpg",thumb:"http://media.izi.travel/fc85dcc2-3e95-40a9-9a78-14705a106230/7104d8b7-2f73-4b98-bfb2-b4245a325ce3_480x360.jpg",statsu:"draft",publish_state:"all",description:"",qr_code:{url:"/img/qr_code.png",print_link:"http://localhost:8000/img/qr_code.png"},images:[{image:"http://media.izi.travel/fc85dcc2-3e95-40a9-9a78-14705a106230/14845c98-05ec-4da8-8aff-11808ecc123f_800x600.jpg",thumb:"http://media.izi.travel/fc85dcc2-3e95-40a9-9a78-14705a106230/7104d8b7-2f73-4b98-bfb2-b4245a325ce3_480x360.jpg",id:1,edit_url:"http://media.izi.travel/fc85dcc2-3e95-40a9-9a78-14705a106230/7104d8b7-2f73-4b98-bfb2-b4245a325ce3_480x360.jpg"},{image:"http://media.izi.travel/fc85dcc2-3e95-40a9-9a78-14705a106230/14845c98-05ec-4da8-8aff-11808ecc123f_800x600.jpg",thumb:"http://media.izi.travel/fc85dcc2-3e95-40a9-9a78-14705a106230/7104d8b7-2f73-4b98-bfb2-b4245a325ce3_480x360.jpg",id:2,edit_url:"http://media.izi.travel/fc85dcc2-3e95-40a9-9a78-14705a106230/7104d8b7-2f73-4b98-bfb2-b4245a325ce3_480x360.jpg"}],stories:{ru:{name:"Богоматерь Владимирская, с двунадесятыми праздниками",description:"test description",audio:"",publish_state:"all",quiz:{question:"are you sure?",description:"can you tell me?",state:"published",answers:[{title:"yes",correct:!1,id:0},{title:"may be",correct:!0,id:1},{title:"who cares?",correct:!1,id:2},{title:"nope",correct:!1,id:3}]}}}}]}),o.bind(r,"current_museum",{defaultValue:{language:"ru",def_lang:"ru",name:"Museum of modern art",index:2,number:3,image:"http://media.izi.travel/fc85dcc2-3e95-40a9-9a78-14705a106230/14845c98-05ec-4da8-8aff-11808ecc123f_800x600.jpg",thumb:"http://media.izi.travel/fc85dcc2-3e95-40a9-9a78-14705a106230/7104d8b7-2f73-4b98-bfb2-b4245a325ce3_480x360.jpg",publish_state:"all",description:"",qr_code:{url:"/img/qr_code.png",print_link:"http://localhost:8000/img/qr_code.png"},images:[{image:"http://media.izi.travel/fc85dcc2-3e95-40a9-9a78-14705a106230/14845c98-05ec-4da8-8aff-11808ecc123f_800x600.jpg",thumb:"http://media.izi.travel/fc85dcc2-3e95-40a9-9a78-14705a106230/7104d8b7-2f73-4b98-bfb2-b4245a325ce3_480x360.jpg",id:1,edit_url:"http://media.izi.travel/fc85dcc2-3e95-40a9-9a78-14705a106230/7104d8b7-2f73-4b98-bfb2-b4245a325ce3_480x360.jpg"},{image:"http://media.izi.travel/fc85dcc2-3e95-40a9-9a78-14705a106230/14845c98-05ec-4da8-8aff-11808ecc123f_800x600.jpg",thumb:"http://media.izi.travel/fc85dcc2-3e95-40a9-9a78-14705a106230/7104d8b7-2f73-4b98-bfb2-b4245a325ce3_480x360.jpg",id:2,edit_url:"http://media.izi.travel/fc85dcc2-3e95-40a9-9a78-14705a106230/7104d8b7-2f73-4b98-bfb2-b4245a325ce3_480x360.jpg"}],stories:{en:{name:"English",language:"en",publish_state:"all",quiz:{question:"are you sure?",description:"can you tell me?",state:"published",answers:[{title:"yes",correct:!1,id:0},{title:"may be",correct:!0,id:1},{title:"who cares?",correct:!1,id:2},{title:"nope",correct:!1,id:3}]}},es:{name:"Spanish",language:"es",publish_state:"all",quiz:{question:"are you sure?",description:"can you tell me?",state:"published",answers:[{title:"yes",correct:!1,id:0},{title:"may be",correct:!0,id:1},{title:"who cares?",correct:!1,id:2},{title:"nope",correct:!1,id:3}]}},ru:{name:"Russian",language:"ru",publish_state:"all",audio:"http://www.jplayer.org/audio/ogg/TSP-01-Cro_magnon_man.ogg",quiz:{question:"are you sure?",description:"can you tell me?",state:"published",answers:[{title:"yes",correct:!1,id:0},{title:"may be",correct:!0,id:1},{title:"who cares?",correct:!1,id:2},{title:"nope",correct:!1,id:3}]}}},new_story_link:"/1/1/1/"}}),m=$("#drop_down").removeClass("hidden").hide(),null!=r.exhibits){for(q=r.exhibits,x=z=0,w=q.length;w>z;x=++z)_=q[x],null!=_?(_.active=!1,_.selected=!1):r.exhibits.splice(x,1);r.active_exhibit=r.exhibits[0]}return f=function(){return $("ul.exhibits li.exhibit.active")},r.dummy_focusout_process=function(){var e,t,i,n,a;if(""===m.find("#name").val()){for(t=!0,a=m.find("#media .form-control:not(#opas_number)"),i=0,n=a.length;n>i;i++)e=a[i],e=$(e),""!==e.val()&&(t=!1);return t?r.new_item_creation=!1:r.dummy_modal_open()}},r.closeDropDown=function(){var e;return e=f(),e.hasClass("dummy")&&r.dummy_focusout_process(e),m.hide(),e.removeClass("active")},r.attachDropDown=function(e){var i;return e=$(e),i=m.hasClass("inited"),m.show().insertAfter(t(e)),i?void 0:(m.addClass("inited"),m.find("a.done, .close").unbind("click").bind("click",function(e){return e.preventDefault(),r.closeDropDown()}),m.find(">.prev-ex").unbind("click").bind("click",function(e){var t,i;return e.preventDefault(),t=f(),i=t.prev(".exhibit"),("drop_down"===i.attr("id")||i.hasClass("dummy"))&&(i=i.prev()),i.length>0?i.find(".opener .description").click():t.siblings(".exhibit").last().find(".opener").click()}),m.find(">.next-ex").unbind("click").bind("click",function(e){var t,i;return e.preventDefault(),t=f(),i=t.next(),("drop_down"===i.attr("id")||i.hasClass("dummy"))&&(i=i.next()),i.length>0?i.find(".opener .description").click():t.siblings(".exhibit").first().find(".opener").click()}),$("#story_quiz_enabled, #story_quiz_disabled").unbind("change").bind("change",function(){var e,t;return e=$(this),t=m.find(".form-wrap"),"story_quiz_enabled"===e.attr("id")?($("label[for=story_quiz_enabled]").text("Enabled"),$("label[for=story_quiz_disabled]").text("Disable"),!0):($("label[for=story_quiz_disabled]").text("Disabled"),$("label[for=story_quiz_enabled]").text("Enable"),!0)}),m.find("a.delete_story").unbind("click").bind("click",function(e){var t;return t=$(this),t.hasClass("no_margin")?(e.preventDefault(),e.stopPropagation(),r.closeDropDown()):void 0}))},r.open_dropdown=function(t,i){var n,a,u,s,o,c,l,d;if(n=$(t.target).parents("li"),n.hasClass("active"))return r.closeDropDown(),!1;for(d=r.exhibits,c=0,l=d.length;l>c;c++)_=d[c],null!=_&&(_.active=!1);return i.active=!0,r.element_switch=!0,r.active_exhibit=i,o=f(),o.hasClass("dummy")&&r.dummy_focusout_process(o),o.removeClass("active"),n.addClass("active"),e(n,o)||(r.attachDropDown(n),setTimeout(function(){return $.scrollTo(n,500)},100)),u=m.find(".item_publish_settings"),a=m.find(".delete_story"),n.hasClass("dummy")?(s=n.data("number"),$("#opas_number").val(s).blur(),$("#name").focus(),u.hide(),a.addClass("no_margin")):(u.show(),a.removeClass("no_margin"))},r.museum_type_filter="",r.grid=function(){var e,t,r,n;return e=$(".exhibits>li.exhibit"),t=60,n=e.first().width(),r=40,i(e,n,r,t)},r.museum_list_prepare=function(){var e,t,i,r;return t=$("ul.museum_list"),e=t.find("li").length,r=$("body").width(),i=(150*e+160)/r,i>1?($(".museum_filters").show(),t.width(r-200)):($(".museum_filters").hide(),t.width(r-100))},setTimeout(function(){return r.museum_list_prepare()},200),$(window).resize(function(){return setTimeout(function(){return r.museum_list_prepare()},100)}),r.new_item_creation=!1,r.all_selected=!1,h=function(){return++r.exhibits[r.exhibits.length-1].number+1||100},p=function(){return++r.exhibits.length},b=function(){return r.current_museum.language},v=function(e){return e===r.current_museum.language?"passcode":"dummy"},g=function(e){return e===r.current_museum.language?"Экспонат_"+e:""},r.create_new_item=function(){var e,t,i,n;if(r.new_item_creation!==!0){r.new_exhibit={content_provider:d,type:"exhibit",distance:20,duration:20,status:"draft",route:"",category:"",parent:y,name:"",number:h(),qr_code:{url:"",print_link:""},stories:{}},r.new_exhibit.images=[{image:"http://media.izi.travel/fc85dcc2-3e95-40a9-9a78-14705a106230/14845c98-05ec-4da8-8aff-11808ecc123f_800x600.jpg",parent:"52472b44774dd1e650000069",thumb:"http://media.izi.travel/fc85dcc2-3e95-40a9-9a78-14705a106230/7104d8b7-2f73-4b98-bfb2-b4245a325ce3_480x360.jpg"}];for(i in r.current_museum.stories)for(r.new_exhibit.stories[i]={playback_algorithm:"generic",content_provider:d,story_type:"story",status:"passcode",language:i,name:"",short_description:"",long_description:"",story_set:"52472b44774dd1e650000069"},r.new_exhibit.stories[i].quiz={story:"52472b44774dd1e650000069",question:"",comment:"",status:"passcode",answers:[]},t=n=0;3>=n;t=++n)r.new_exhibit.stories[i].quiz.answers.push({quiz:"52472b44774dd1e650000069",content:"",correct:!1});return r.new_item_creation=!0,e={},e.target=$("li.exhibit.dummy > .opener.draft"),r.open_dropdown(e,r.new_exhibit),r.grid(),r.exhibits.splice(r.exhibits.length-1,1)}},r.modal_options={current_language:{name:"Russian",language:"ru"},languages:r.current_museum.stories},r.check_selected=function(){var e,t,i,n;for(e=0,r.select_all_enabled=!1,n=r.exhibits,t=0,i=n.length;i>t;t++)_=n[t],_.selected===!0&&(r.select_all_enabled=!0,e+=1);return e===r.exhibits.length?r.all_selected=!0:void 0},r.select_all_exhibits=function(){var e,t,i,n;for(e=!r.all_selected,n=r.exhibits,t=0,i=n.length;i>t;t++)_=n[t],_.selected=e;return r.all_selected=!r.all_selected,r.select_all_enabled=e},r.delete_modal_open=function(){var e;return e=s.open({templateUrl:"myModalContent.html",controller:ModalDeleteInstanceCtrl,resolve:{modal_options:function(){return r.modal_options}}}),e.result.then(function(e){var t,i,a,u,s,o,c,l,d;if(r.selected=e,Object.keys(r.active_exhibit.stories).length===e.length){for(r.closeDropDown(),o=r.exhibits,l=[],x=u=0,s=o.length;s>u;x=++u){if(_=o[x],_._id===r.active_exhibit._id){r.exhibits.splice(x,1),r.grid(),n["delete"](""+r.backend_url+"/story_set/"+r.active_exhibit._id+"/").success(function(e){return console.log(e),r.active_exhibit=r.exhibits[0]}).error(function(){return console.log("error")});break}l.push(void 0)}return l}c=r.active_exhibit.stories,d=[];for(i in c)a=c[i],d.push(function(){var n,u,s;for(s=[],n=0,u=e.length;u>n;n++)t=e[n],t===i?(a=r.active_exhibit.stories[i],a.status="dummy",a.name="",a.short_description="",a.long_description="",a.quiz.question="",a.quiz.comment="",a.quiz.status="",a.quiz.answers[0].content="",a.quiz.answers[0].correct=!0,a.quiz.answers[1].content="",a.quiz.answers[1].correct=!1,a.quiz.answers[2].content="",a.quiz.answers[2].correct=!1,a.quiz.answers[3].content="",a.quiz.answers[3].correct=!1,s.push(r.update_story(a))):s.push(void 0);return s}());return d},function(){return console.log("Modal dismissed at: "+new Date)})},r.dummy_modal_open=function(){var e;return e=s.open({templateUrl:"myDummyModalContent.html",controller:ModalDummyInstanceCtrl,resolve:{modal_options:function(){return{exhibit:r.active_exhibit}}}}),e.result.then(function(e){return r.new_item_creation=!1,r.item_deletion=!0,"save_as"===e?(r.new_exhibit.stories[r.current_museum.language].name="item_"+r.new_exhibit.number,r.new_exhibit.stories[r.current_museum.language].publish_state="passcode",r.new_exhibit.active=!1,r.exhibits.push(r.new_exhibit)):(r.closeDropDown(),r.new_exhibit.active=!1,r.active_exhibit=r.exhibits[0]),r.item_deletion=!1},function(){return console.log("Modal dismissed at: "+new Date)})},r.show_museum_edit=function(e){var t;return t=$(e.target),$(".navigation .museum_edit, .page .museum_edit_guaranter").slideToggle(1e3,"easeOutQuint"),t.find("i").toggleClass("icon-chevron-down icon-chevron-up"),r.museum_edit_dropdown_opened=!r.museum_edit_dropdown_opened,!1},r.museum_edit_dropdown_close=function(){return setTimeout(function(){return $(".actions_bar .museum_edit_opener").click()},10)},r.update_story=function(e){return n.put(""+r.backend_url+"/story/"+e._id,e).success(function(){return n.put(""+r.backend_url+"/quiz/"+e.quiz._id,e.quiz).success(function(){var t,i,n,a,u;for(a=e.quiz.answers,u=[],i=0,n=a.length;n>i;i++)t=a[i],u.push(r.put_answers(t));return u}).error(function(){return console.log("error")})}).error(function(){return console.log("error")})},r.put_answers=function(e){return n.put(""+r.backend_url+"/quiz_answer/"+e._id,e).success(function(){return console.log("done")}).error(function(){return console.log("error")})},r.museum_edit_dropdown_close=function(){return setTimeout(function(){return $(".actions_bar .museum_edit_opener").click()},10)},r.post_stories=function(e){return n.post(""+r.backend_url+"/story/",e).success(function(t){return e._id=t._id,e.quiz.story=t._id,n.post(""+r.backend_url+"/quiz/",e.quiz).success(function(t){var i,n,a,u,s;for(e.quiz._id=t.id,u=e.quiz.answers,s=[],n=0,a=u.length;a>n;n++)i=u[n],i.quiz=t._id,s.push(r.post_answers(i));return s}).error(function(){return console.log("error")})}).error(function(){return console.log("error")})},r.post_answers=function(e){return n.post(""+r.backend_url+"/quiz_answer/",e).success(function(t){return e._id=t._id}).error(function(){return console.log("error")})},r.$on("save_new_exhibit",function(){return console.log("saving!"),n.post(""+r.backend_url+"/story_set/",r.new_exhibit).success(function(e){var t,i,a,u,s;r.exhibits.push(r.new_exhibit),i=r.new_exhibit.images[0],i.parent=e._id,n.post(""+r.backend_url+"/media/",i).success(function(){return i._id=i._id}).error(function(){return console.log("error")}),u=r.new_exhibit.stories,s=[];for(t in u)a=u[t],a.publish_state="passcode",a.story_set=e._id,s.push(r.post_stories(a));return s}).error(function(){return console.log("fail")}),r.new_item_creation=!1}),r.$on("changes_to_save",function(e,t){return n.put(""+r.backend_url+"/"+t.field_type+"/"+t.item._id,t.item).success(function(e){return t.satus="done",console.log(e)}).error(function(){return console.log("fail")})}),r.$on("quiz_changes_to_save",function(e,t,i){var a,u,s,o,c,l;for(c=t.collection,l=[],s=0,o=c.length;o>s;s++)u=c[s],a=u._id===i._id?!0:!1,u.correct=a,u.correct_saved=a,l.push(n.put(""+r.backend_url+"/"+t.field_type+"/"+u._id,u).success(function(e){return console.log(e)}).error(function(){return console.log("fail")}));return l}),r.populate_localstorage=function(){var e,t,i,n,a,u,s;for(u=r.exhibits,i=0,a=u.length;a>i;i++){_=u[i];for(t in r.current_museum.stories)null==_.stories[t]&&(_.stories[t]={language:t,name:"",description:"",audio:"",publish_state:"dummy",quiz:{question:"",description:"",state:"",answers:[{title:"",correct:!1,id:0},{title:"",correct:!0,id:1},{title:"",correct:!1,id:2},{title:"",correct:!1,id:3}]}})}for(s=[],e=n=0;22>=n;e=++n){_={index:r.exhibits[r.exhibits.length-1].index+1,name:"Экспонат",number:r.exhibits[r.exhibits.length-1].index+1,image:"http://media.izi.travel/fc85dcc2-3e95-40a9-9a78-14705a106230/14845c98-05ec-4da8-8aff-11808ecc123f_800x600.jpg",thumb:"http://media.izi.travel/fc85dcc2-3e95-40a9-9a78-14705a106230/7104d8b7-2f73-4b98-bfb2-b4245a325ce3_480x360.jpg",description:"",qr_code:{url:"/img/qr_code.png",print_link:"http://localhost:8000/img/qr_code.png"},images:[{image:"http://media.izi.travel/fc85dcc2-3e95-40a9-9a78-14705a106230/14845c98-05ec-4da8-8aff-11808ecc123f_800x600.jpg",thumb:"http://media.izi.travel/fc85dcc2-3e95-40a9-9a78-14705a106230/7104d8b7-2f73-4b98-bfb2-b4245a325ce3_480x360.jpg",id:1,edit_url:"http://media.izi.travel/fc85dcc2-3e95-40a9-9a78-14705a106230/7104d8b7-2f73-4b98-bfb2-b4245a325ce3_480x360.jpg"},{image:"http://media.izi.travel/fc85dcc2-3e95-40a9-9a78-14705a106230/14845c98-05ec-4da8-8aff-11808ecc123f_800x600.jpg",thumb:"http://media.izi.travel/fc85dcc2-3e95-40a9-9a78-14705a106230/7104d8b7-2f73-4b98-bfb2-b4245a325ce3_480x360.jpg",id:2,edit_url:"http://media.izi.travel/fc85dcc2-3e95-40a9-9a78-14705a106230/7104d8b7-2f73-4b98-bfb2-b4245a325ce3_480x360.jpg"}]},_.stories={};for(t in r.current_museum.stories)_.stories[t]={language:t.language,name:g(t),description:"test description",audio:"",publish_state:v(t),quiz:{question:"are you sure?",description:"can you tell me?",state:"limited",answers:[{title:"yes",correct:!1,id:0},{title:"may be",correct:!0,id:1},{title:"who cares?",correct:!1,id:2},{title:"nope",correct:!1,id:3}]}};s.push(r.exhibits.push(_))}return s}}]).controller("DropDownController",["$scope","$http","$filter","$window","$modal","storage","$rootScope",function(e,t){return e.quiz_state=function(i,r){return e.mark_quiz_validity(i.$valid),i.$valid?setTimeout(function(){return t.put(""+e.backend_url+"/quiz/"+r._id,r).success(function(e){return console.log(e)}).error(function(){return console.log("fail")}),!0},50):setTimeout(function(){return $("#story_quiz_disabled").click()},300),!0},e.mark_quiz_validity=function(e){var t;return t=$("#quiz form"),e?t.removeClass("has_error"):t.addClass("has_error"),!0},e.$watch("$parent.active_exhibit.stories[$parent.current_museum.language].quiz",function(t){return"published"===t.status?$("#story_quiz_enabled").is(":checked")?setTimeout(function(){return e.quizform.$valid?void 0:setTimeout(function(){return $("#story_quiz_disabled").click()},10)},100):setTimeout(function(){return $("#story_quiz_enabled").click()},10):$("#story_quiz_disabled").is(":checked")?void 0:setTimeout(function(){return $("#story_quiz_disabled").click()},10)},!0),e.$watch("$parent.active_exhibit.stories[$parent.current_museum.language].quiz.question",function(){return null!=e.quizform?e.quizform.$valid?e.mark_quiz_validity(e.quizform.$valid):setTimeout(function(){return $("#story_quiz_disabled").click(),e.mark_quiz_validity(e.quizform.$valid)},10):void 0}),e.$watch("$parent.active_exhibit.stories[$parent.current_museum.language].name",function(t,i){var r;if(r=$("#media form"),r.length>0)if("dummy"===e.$parent.active_exhibit.stories[e.$parent.current_museum.language].status){if(t)return e.$parent.active_exhibit.stories[e.$parent.current_museum.language].status="passcode"}else if(!e.$parent.new_item_creation&&!t)return e.$parent.active_exhibit.stories[e.$parent.current_museum.language].name=i,$(".empty_name_error.name").show(),setTimeout(function(){return $(".empty_name_error.name").hide()},1500)}),e.$watch("$parent.element_switch",function(t,i){return t!==i?setTimeout(function(){return e.$parent.element_switch=!1},100):void 0}),e.$watch("$parent.active_exhibit.number",function(t,i){var r;return r=$("#media form"),r.length>0&&!e.$parent.new_item_creation&&!e.$parent.item_deletion&&!t?(e.$parent.active_exhibit.number=i,$(".empty_name_error.number").show(),setTimeout(function(){return $(".empty_name_error.number").hide()},1500)):void 0}),e.$watch(function(){return angular.toJson(e.$parent.active_exhibit.stories[e.$parent.current_museum.language].quiz.answers)},function(){return null!=e.quizform?e.quizform.$valid?e.mark_quiz_validity(e.quizform.$valid):setTimeout(function(){return $("#story_quiz_disabled").click()},10):void 0},!0),e.$watch("$parent.active_exhibit.stories[$parent.current_museum.language]",function(i){return i&&!e.$parent.active_exhibit.stories[e.$parent.current_museum.language].qr_code?t.get(""+e.$parent.backend_url+"/qr_code/"+e.$parent.active_exhibit.stories[e.$parent.current_museum.language]._id).success(function(t){return e.$parent.active_exhibit.stories[e.$parent.current_museum.language].qr_code=t}):void 0},!0),e.upload_image=function(e){var t,i;return e.preventDefault(),t=$(e.target),i=t.parents(".images"),i.find("li:hidden").isEmpty()&&$.ajax({url:t.attr("href"),async:!1,success:function(e){return console.log(e)}}),i.find("li:hidden :file").click()},e.delete_image=function(e){var t,i;return e.preventDefault(),e.stopPropagation(),t=$(e.target),i=t.parents("#images, #maps"),confirm(t.data("confirm"))?$.ajax({url:t.attr("href"),type:t.data("method"),data:{authentity_token:$("meta[name=csrf-token]").attr("content")},success:function(){var e;return e=200,i.attr("id").match(/images/)?t.parents("li").fadeOut(e,function(){return t.remove(),storySetImage.trigger("image:deleted")}):t.parents("li").fadeOut(e,function(){return t.remove()})}}):void 0},e.change_image=function(e){var t,i;return t=$(e.target),i=t.parents("form"),t.hasClass("disabled")?void 0:i.find(":file").trigger("click")},!0}]).controller("MuseumEditController",["$scope","$http","$filter","$window","$modal","storage",function(e){return e.museum_quiz_state=function(t){return e.mark_quiz_validity(t.$valid),t.$valid||setTimeout(function(){return $("#museum_story_quiz_disabled").click()},300),!0},e.mark_quiz_validity=function(e){var t;return t=$("#museum_quiz form"),e?t.removeClass("has_error"):t.addClass("has_error"),!0},e.$watch("$parent.current_museum.stories[$parent.current_museum.language].quiz",function(t){if("limited"===t.state){if(!$("#museum_story_quiz_disabled").is(":checked"))return setTimeout(function(){return $("#museum_story_quiz_disabled").click()},10)}else if("published"===t.state)return $("#museum_story_quiz_enabled").is(":checked")?setTimeout(function(){return e.museumQuizform.$valid?void 0:setTimeout(function(){return $("#museum_story_quiz_disabled").click()},10)},100):setTimeout(function(){return $("#museum_story_quiz_enabled").click()},10)},!0),e.$watch("$parent.current_museum.stories[$parent.current_museum.language].quiz.question",function(){return null!=e.museumQuizform?e.museumQuizform.$valid?e.mark_quiz_validity(e.museumQuizform.$valid):setTimeout(function(){return $("#story_quiz_disabled").click(),e.mark_quiz_validity(e.museumQuizform.$valid)},10):void 0}),e.$watch(function(){return angular.toJson(e.$parent.current_museum.stories[e.$parent.current_museum.language].quiz.answers)},function(){return null!=e.museumQuizform?e.museumQuizform.$valid?e.mark_quiz_validity(e.museumQuizform.$valid):setTimeout(function(){return $("#museum_#story_quiz_disabled").click()},10):void 0},!0),!0}]),this.ModalDeleteInstanceCtrl=function(e,t,i){return e.modal_options=i,e.only_one=1===e.modal_options.languages.length,e.ok=function(){var i,r,n;e.selected=[],n=e.modal_options.languages;for(i in n)r=n[i],r.checked===!0&&e.selected.push(i);return t.close(e.selected)},e.cancel=function(){return t.dismiss()},e.mark_all=function(){var t,i,r,n;r=e.modal_options.languages,n=[];for(t in r)i=r[t],n.push(i.checked=!0);return n},e.mark_default_only=function(){var t,i,r,n;r=e.modal_options.languages,n=[];for(t in r)i=r[t],i.checked=!1,e.modal_options.current_language.language===t?n.push(i.checked=!0):n.push(void 0);return n},e.mark_default_only()},this.ModalDummyInstanceCtrl=function(e,t,i){return e.exhibit=i.exhibit,e.discard=function(){return t.close("discard")},e.save_as=function(){return t.close("save_as")}}}).call(this);