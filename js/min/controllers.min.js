(function(){"use strict";var e,t,i;t=function(e){var t,i;return e=$(e),i=e.offset().top,t=function(){return i<$(this).offset().top},$.merge(e,e.nextUntil(t)).last()},e=function(e,t){return e.length>0&&t.length>0&&e.offset().top===t.offset().top},i=function(e,t,i,a){var n,r,s,o,c,d;return d=$(window).innerWidth(),o=t+i,c=d-2*a+i,r=Math.floor(c/o),n=d-(r*o-i),s=Math.floor(n/2),e.css({"margin-right":0,"margin-left":i}),e.each(function(e){return 0===e%r?$(this).css({"margin-left":s}):void 0})},angular.module("Museum.controllers",[]).controller("IndexController",["$scope","$http","$filter","$window","sharedProperties",function(a,n,r,s,o){var c,d,u,l,m;return a.museums=[{name:"Imperial Peace Museum",packege_status:"generated",city:"London",image:"/img/museum.jpg",type:"museum"},{name:"Imperial War Museum",packege_status:"generated",city:"Tokio",image:"/img/museum.jpg",type:"museum"},{name:"Imperial Peace Exhibitin",packege_status:"generated",city:"Moscow",image:"/img/museum.jpg",type:"museum"},{name:"Imperial War Exhibitin",packege_status:"generated",city:"Berlin",image:"/img/museum.jpg",type:"museum"},{name:"Republican Peace Museum",packege_status:"process",city:"Tokio",image:"/img/museum.jpg",type:"tour"},{name:"Republican Peace Exhibitin",packege_status:"process",city:"London",image:"/img/museum.jpg",type:"tour"},{name:"Republican War Museum",packege_status:"process",city:"Berlin",image:"/img/museum.jpg",type:"tour"},{name:"Republican War Exhibitin",packege_status:"process",city:"London",image:"/img/museum.jpg",type:"museum"}],a.current_museum={language:"ru",name:"Museum of modern art",stories:[{name:"Russian",language:"ru"},{name:"Spanish",language:"es"},{name:"English",language:"en"}],new_story_link:"/1/1/1/"},a.user={mail:"pman89@yandex.ru",providers:[{name:"IZI.travel Test Provider"},{name:"IZI.travel Second Provider"}]},a.provider={name:"content_1",id:"1",passcode:"passcode",passcode_edit_link:"/1/pass/edit/"},a.exhibits=[{name:"Богоматерь Владимирская, с двунадесятыми праздниками",number:"1",image:"http://media.izi.travel/fc85dcc2-3e95-40a9-9a78-14705a106230/14845c98-05ec-4da8-8aff-11808ecc123f_800x600.jpg",thumb:"http://media.izi.travel/fc85dcc2-3e95-40a9-9a78-14705a106230/7104d8b7-2f73-4b98-bfb2-b4245a325ce3_480x360.jpg",publish_state:"all",description:"",qr_code:{url:"/img/qr_code.png",print_link:"http://localhost:8000/img/qr_code.png"},images:[{image:"http://media.izi.travel/fc85dcc2-3e95-40a9-9a78-14705a106230/14845c98-05ec-4da8-8aff-11808ecc123f_800x600.jpg",thumb:"http://media.izi.travel/fc85dcc2-3e95-40a9-9a78-14705a106230/7104d8b7-2f73-4b98-bfb2-b4245a325ce3_480x360.jpg"},{image:"http://media.izi.travel/fc85dcc2-3e95-40a9-9a78-14705a106230/14845c98-05ec-4da8-8aff-11808ecc123f_800x600.jpg",thumb:"http://media.izi.travel/fc85dcc2-3e95-40a9-9a78-14705a106230/7104d8b7-2f73-4b98-bfb2-b4245a325ce3_480x360.jpg"}],stories:[{language:"ru",name:"Богоматерь Владимирская, с двунадесятыми праздниками",description:"test description",audio:"http://www.jplayer.org/audio/ogg/TSP-01-Cro_magnon_man.ogg",quiz:{question:"are you sure?",description:"can you tell me?",answers:[{title:"yes",correct:!1,id:0},{title:"may be",correct:!0,id:1},{title:"who cares?",correct:!1,id:2},{title:"nope",correct:!1,id:3}]}}]},{name:"Богоматерь Владимирская, с двунадесятыми праздниками",number:"1",image:"http://media.izi.travel/fc85dcc2-3e95-40a9-9a78-14705a106230/14845c98-05ec-4da8-8aff-11808ecc123f_800x600.jpg",thumb:"http://media.izi.travel/fc85dcc2-3e95-40a9-9a78-14705a106230/7104d8b7-2f73-4b98-bfb2-b4245a325ce3_480x360.jpg",publish_state:"all",description:"",qr_code:{url:"/img/qr_code.png",print_link:"http://localhost:8000/img/qr_code.png"},images:[{image:"http://media.izi.travel/fc85dcc2-3e95-40a9-9a78-14705a106230/14845c98-05ec-4da8-8aff-11808ecc123f_800x600.jpg",thumb:"http://media.izi.travel/fc85dcc2-3e95-40a9-9a78-14705a106230/7104d8b7-2f73-4b98-bfb2-b4245a325ce3_480x360.jpg"},{image:"http://media.izi.travel/fc85dcc2-3e95-40a9-9a78-14705a106230/14845c98-05ec-4da8-8aff-11808ecc123f_800x600.jpg",thumb:"http://media.izi.travel/fc85dcc2-3e95-40a9-9a78-14705a106230/7104d8b7-2f73-4b98-bfb2-b4245a325ce3_480x360.jpg"}],stories:[{language:"ru",name:"Богоматерь Владимирская, с двунадесятыми праздниками",description:"test description",audio:"http://www.jplayer.org/audio/ogg/TSP-01-Cro_magnon_man.ogg",quiz:{question:"are you sure?",description:"can you tell me?",answers:[{title:"yes",correct:!0,id:0},{title:"may be",correct:!1,id:1},{title:"who cares?",correct:!1,id:2},{title:"nope",correct:!1,id:3}]}}]},{name:"Богоматерь Владимирская, с двунадесятыми праздниками",number:"1",image:"http://media.izi.travel/fc85dcc2-3e95-40a9-9a78-14705a106230/14845c98-05ec-4da8-8aff-11808ecc123f_800x600.jpg",thumb:"http://media.izi.travel/fc85dcc2-3e95-40a9-9a78-14705a106230/7104d8b7-2f73-4b98-bfb2-b4245a325ce3_480x360.jpg",statsu:"draft",publish_state:"all",description:"",qr_code:{url:"/img/qr_code.png",print_link:"http://localhost:8000/img/qr_code.png"},images:[{image:"http://media.izi.travel/fc85dcc2-3e95-40a9-9a78-14705a106230/14845c98-05ec-4da8-8aff-11808ecc123f_800x600.jpg",thumb:"http://media.izi.travel/fc85dcc2-3e95-40a9-9a78-14705a106230/7104d8b7-2f73-4b98-bfb2-b4245a325ce3_480x360.jpg"},{image:"http://media.izi.travel/fc85dcc2-3e95-40a9-9a78-14705a106230/14845c98-05ec-4da8-8aff-11808ecc123f_800x600.jpg",thumb:"http://media.izi.travel/fc85dcc2-3e95-40a9-9a78-14705a106230/7104d8b7-2f73-4b98-bfb2-b4245a325ce3_480x360.jpg"}],stories:[{language:"ru",name:"Богоматерь Владимирская, с двунадесятыми праздниками",description:"test description",audio:"http://www.jplayer.org/audio/ogg/TSP-01-Cro_magnon_man.ogg",quiz:{question:"are you sure?",description:"can you tell me?",answers:[{title:"yes",correct:!0,id:0},{title:"may be",correct:!1,id:1},{title:"who cares?",correct:!1,id:2},{title:"nope",correct:!1,id:3}]}}]}],u=$("#drop_down").removeClass("hidden").hide(),m=function(){return $("ul.exhibits li.exhibit.active")},l=function(e){var t,i,a,n,r,s;if(""===u.find("#name").val()){for(a=!0,s=u.find("#media .form-control:not(#opas_number)"),n=0,r=s.length;r>n;n++)t=s[n],t=$(t),""!==t.val()&&(a=!1);return a?e.remove():(i=e.data("number"),$("ul.exhibits").append(modal_template(i)),$("#dummyModal").modal({show:!0,backdrop:"static"}),$("#dummyModal").find(".btn-default").click(function(){return e.remove(),$("#dummyModal, .modal-backdrop").remove()}),$("#dummyModal").find(".btn-primary").click(function(){return e.removeClass("dummy"),u.find("#name").val("item_"+i),e.find(".opener").removeClass("draft"),$("#dummyModal, .modal-backdrop").remove()}))}},d=function(){var e;return e=m(),e.hasClass("dummy")&&l(e),u.hide(),e.removeClass("active")},c=function(e){var i;return e=$(e),i=u.hasClass("inited"),u.show().insertAfter(t(e)),i?void 0:(u.addClass("inited"),u.find("a.done, .close").unbind("click").bind("click",function(e){return e.preventDefault(),d()}),u.find(">.prev-ex").unbind("click").bind("click",function(e){var t,i;return e.preventDefault(),t=m(),i=t.prev(".exhibit"),"drop_down"===i.attr("id")&&(i=i.prev()),i.length>0?i.find(".opener .description").click():t.siblings(".exhibit").last().find(".opener").click()}),u.find(">.next-ex").unbind("click").bind("click",function(e){var t,i;return e.preventDefault(),t=m(),i=t.next(),"drop_down"===i.attr("id")&&(i=i.next()),i.length>0?i.find(".opener .description").click():t.siblings(".exhibit").first().find(".opener").click()}),u.find(".label-content").unbind("click").bind("click",function(){var e,t;return e=$(this),t=e.parents(".dropdown-menu").prev(".dropdown-toggle"),e.hasClass("everyone")?t.html("<div class='extra'><i class='icon-globe'></i></div> Published <span class='caret'></span>"):t.html("<div class='extra'><i class='icon-user'></i></div> Publish <span class='caret'></span>")}),u.find("#delete_story input[type=radio]").unbind("change").bind("change",function(){var e,t;return t=$(this),e=$("#delete_story"),"lang_selected"!==t.attr("id")?$("#delete_story .other_variants").slideUp(150):t.is(":checked")?$("#delete_story .other_variants").slideDown(150):void 0}),$("#story_quiz_enabled, #story_quiz_disabled").unbind("change").bind("change",function(){var e,t;return e=$(this),t=u.find(".form-wrap"),console.log(e.val()),"story_quiz_enabled"===e.attr("id")?($("label[for=story_quiz_enabled]").text("Enabled"),$("label[for=story_quiz_disabled]").text("Disable"),!0):($("label[for=story_quiz_disabled]").text("Disabled"),$("label[for=story_quiz_enabled]").text("Enable"),!0)}),u.find("a.delete_story").unbind("click").bind("click",function(e){var t;return t=$(this),t.hasClass("no_margin")?(e.preventDefault(),e.stopPropagation(),d()):void 0}))},a.open_dropdown=function(t){var i,a,n,r,s,o,p;return i=$(t.target).parents("li"),i.hasClass("active")?(d(),!1):(p=m(),p.hasClass("dummy")&&l(p),p.removeClass("active"),i.addClass("active"),u.find("h2").text(i.find("h4").text()),e(i,p)||(c(i),$("body").scrollTo(i,500,150)),s=u.find(".item_publish_settings"),r=u.find(".done"),a=u.find(".close"),n=u.find(".delete_story"),i.hasClass("dummy")?(o=i.data("number"),$("#opas_number").val(o).blur(),$("#name").focus(),s.hide(),r.hide(),a.show(),n.addClass("no_margin")):(s.show(),r.show(),a.hide(),n.removeClass("no_margin")))},a.museum_type_filter="",a.grid=function(){var e,t,a,n;return e=$(".exhibits>li.exhibit"),t=59,n=e.width(),a=parseInt(e.css("margin-left"))+parseInt(e.css("margin-right")),$(".exhibits").css({"text-align":"left"}),i(e,n,a,t),$(window).resize(i.bind(this,e,n,a,t))},a.museum_list_prepare=function(){var e,t,i,a;return t=$("ul.museum_list"),e=t.find("li").length,a=$("body").width(),i=(150*e+160)/a,i>1?($(".museum_filters").show(),t.width(a-200)):($(".museum_filters").hide(),t.width(a-100))},setTimeout(function(){return a.grid(),a.museum_list_prepare()},100),o.setProperty("exhibit",a.exhibits[0]),angular.element(s).bind("resize",function(){return a.grid(),a.museum_list_prepare()}),$(".museum_navigation_menu .search").click(function(){var e;return e=$(this),e.hide(),e.next().show().children().first().focus()}),$(".museum_navigation_menu .search_input input").blur(function(){var e,t;return e=$(this),t=e.parents(".search_input"),e.animate({width:"150px"},150,function(){return t.hide(),t.prev().show()})}),$(".museum_navigation_menu .search_input input").focus(function(){var e,t;return e=$(this),t=$("body").width()-700,t>150?e.animate({width:""+t+"px"},300):void 0}),a.toggle_menu=function(e){var t,i,a;return e=$(e.target),t=$(".museum_navigation_menu"),i=$(".navigation"),t.is(":visible")?(a=e.data("last-padding"),t.slideUp(300),i.addClass("navbar-fixed-top"),$("body").css({"padding-top":""+a})):(a=$("body").css("padding-top"),e.data("last-padding",a),t.slideDown(300),i.removeClass("navbar-fixed-top"),$("body").css({"padding-top":"0px"}))},a.toggle_filters=function(e){var t,i;return e=$(e.target),t=$(".filters_bar"),i=$(".navigation"),e.hasClass("active")?(t.css({overflow:"hidden"}),t.animate({height:"0px"},200),e.removeClass("active"),i.hasClass("navbar-fixed-top")?$("body").animate({"padding-top":"-=44px"},200):void 0):(t.animate({height:"44px"},200,function(){return t.css({overflow:"visible"})}),i.hasClass("navbar-fixed-top")&&$("body").animate({"padding-top":"+=44px"},200),e.addClass("active"))}}]).controller("EditItemController",["$scope","$http","$filter","sharedProperties",function(e,t,i,a){return e.exhibit=a.getProperty("exhibit"),e.$on("exhibitChange",function(){return e.exhibit=a.getProperty("exhibit")})}])}).call(this);