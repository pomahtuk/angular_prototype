(function(){"use strict";var e,i,a,r,n;$.fn.refresh=function(){return $(this.selector)},$.fn.isEmpty=function(){return 0===this.length},r=function(e){var t,i;return e=$(e),i=e.offset().top,t=function(){return i<$(this).offset().top},$.merge(e,e.nextUntil(t)).last()},a=function(e,t){return e.length>0&&t.length>0&&e.offset().top===t.offset().top},n=function(e,t,i,a){var r,n,s,o,c,u;return u=$(window).innerWidth(),o=t+i,c=u-2*a+i,n=Math.floor(c/o),r=u-(n*o-i),s=Math.floor(r/2),e.css({"margin-right":0,"margin-left":i}),e.each(function(e){return 0===e%n?$(this).css({"margin-left":s}):void 0})},this.gon={google_api_key:"AIzaSyCPyGutBfuX48M72FKpF4X_CxxPadq6r4w",acceptable_extensions:{audio:["mp3","ogg","aac","wav","amr","3ga","m4a","wma","mp4","mp2","flac"],image:["jpg","jpeg","gif","png","tiff","bmp"],video:["mp4","m4v"]},development:!1},i=50,e=gon.acceptable_extensions,this.correctExtension=function(t){var i;return i=t.files[0].name.split(".").pop().toLowerCase(),-1!==$.inArray(i,e[t.fileInput.context.dataset.accept])},this.correctFileSize=function(e){return e.files[0]&&e.files[0].size<1024*1024*i},this.initFileUpload=function(e,a,r){return null==a&&(a=null),null==r&&(r={}),console.log("inited"),(a||$(".fileupload")).each(function(){var e,a,n,s,o,c,u;return u=null,e=$(this),o=e.parent("form"),s=o.parent(),a=o.find("a.btn.browse"),n=o.find("a.btn.cancel"),c=r.progress||o.find(".progress"),n.unbind("click"),n.bind("click",function(e){return e.preventDefault(),u?u.abort():void 0}),e.fileupload({add:function(e,r){return correctExtension(r)?correctFileSize(r)?(a.addClass("disabled"),n.removeClass("hide"),c.removeClass("hide"),r.form.find(".help-tooltip").remove(),r.submit()):Message.error(t("message.errors.media_content.file_size",{file_size:i})):Message.error(t("message.errors.media_content.file_type"))},beforeSend:function(e){return c.find(".bar").width("0%"),u=e},success:function(e){return s.replaceWith(e).hide().fadeIn(function(){return $("a.thumb").trigger("image:uploaded")}),$("#edit_story_form").trigger("form:loaded"),Message.notice(t("message.media_content.uploaded"))},complete:function(){return n.addClass("hide"),c.addClass("hide"),a.removeClass("disabled")},error:function(i,a,r){var n,s;return e.val(""),"abort"===r?Message.notice(t("message.media_content.canceled")):422===i.status?(n=jQuery.parseJSON(i.responseText),s=n.link[0],Message.error(s)):Message.error(t("message.errors.media_content.try_again"))},progressall:function(e,t){var i;return i=parseInt(100*(t.loaded/t.total),10),c.find(".bar").width(i+"%")}})})},this.checkAudioFiles=function(){return $("#audio_form[data-audio-check-url]").each(function(){var e,i;return e=$(this),i=e.data("audio-check-url"),$.ajax({url:i,type:"GET",dataType:"json",success:function(t){return $.each(t,function(t,i){var a,r,n,s;return n=$(".btn."+t),i.exist?(a=e.find(".audio-upload-form").find("audio."+t),a.empty(),$("<source>").attr("src",i.file).appendTo(a),r=a.get(0),r&&(r.pause(),r.load(),s=!!r.canPlayType&&""!==r.canPlayType(i.content_type),console.log(s+" - "+i.content_type)),$(".play."+t).find("i").removeClass("icon-pause").addClass("icon-play"),s?n.removeClass("disabled hide"):n.addClass("disabled").removeClass("hide")):n.addClass("disabled")})},error:function(){return Message.notice(t("message.media_content.not_processed_yet"))}})})},angular.module("Museum.controllers",[]).controller("IndexController",["$scope","$http","$filter","$window","$modal","storage",function(e,t,i,s,o,c){var u,l,d,m,p,f,_,b,g,h,v,x;for(window.sc=e,e.museums=[{name:"Imperial Peace Museum",packege_status:"generated",city:"London",image:"/img/museum.jpg",type:"museum"},{name:"Imperial War Museum",packege_status:"generated",city:"Tokio",image:"/img/museum.jpg",type:"museum"},{name:"Imperial Peace Exhibitin",packege_status:"generated",city:"Moscow",image:"/img/museum.jpg",type:"museum"},{name:"Imperial War Exhibitin",packege_status:"generated",city:"Berlin",image:"/img/museum.jpg",type:"museum"},{name:"Republican Peace Museum",packege_status:"process",city:"Tokio",image:"/img/museum.jpg",type:"tour"},{name:"Republican Peace Exhibitin",packege_status:"process",city:"London",image:"/img/museum.jpg",type:"tour"},{name:"Republican War Museum",packege_status:"process",city:"Berlin",image:"/img/museum.jpg",type:"tour"},{name:"Republican War Exhibitin",packege_status:"process",city:"London",image:"/img/museum.jpg",type:"museum"}],e.user={mail:"pman89@yandex.ru",providers:[{name:"IZI.travel Test Provider"},{name:"IZI.travel Second Provider"}]},e.provider={name:"content_1",id:"1",passcode:"passcode",passcode_edit_link:"/1/pass/edit/"},e.translations={ru:"Russian",en:"English",es:"Spanish"},c.bind(e,"exhibits",{defaultValue:[{index:0,name:"Богоматерь Владимирская, с двунадесятыми праздниками",number:"1",image:"http://media.izi.travel/fc85dcc2-3e95-40a9-9a78-14705a106230/14845c98-05ec-4da8-8aff-11808ecc123f_800x600.jpg",thumb:"http://media.izi.travel/fc85dcc2-3e95-40a9-9a78-14705a106230/7104d8b7-2f73-4b98-bfb2-b4245a325ce3_480x360.jpg",publish_state:"all",description:"",qr_code:{url:"/img/qr_code.png",print_link:"http://localhost:8000/img/qr_code.png"},images:[{image:"http://media.izi.travel/fc85dcc2-3e95-40a9-9a78-14705a106230/14845c98-05ec-4da8-8aff-11808ecc123f_800x600.jpg",thumb:"http://media.izi.travel/fc85dcc2-3e95-40a9-9a78-14705a106230/7104d8b7-2f73-4b98-bfb2-b4245a325ce3_480x360.jpg",id:1,edit_url:"http://media.izi.travel/fc85dcc2-3e95-40a9-9a78-14705a106230/7104d8b7-2f73-4b98-bfb2-b4245a325ce3_480x360.jpg"},{image:"http://media.izi.travel/fc85dcc2-3e95-40a9-9a78-14705a106230/14845c98-05ec-4da8-8aff-11808ecc123f_800x600.jpg",thumb:"http://media.izi.travel/fc85dcc2-3e95-40a9-9a78-14705a106230/7104d8b7-2f73-4b98-bfb2-b4245a325ce3_480x360.jpg",id:2,edit_url:"http://media.izi.travel/fc85dcc2-3e95-40a9-9a78-14705a106230/7104d8b7-2f73-4b98-bfb2-b4245a325ce3_480x360.jpg"}],stories:{ru:{name:"Богоматерь Владимирская, с двунадесятыми праздниками",description:"test description",publish_state:"all",audio:"http://www.jplayer.org/audio/ogg/TSP-01-Cro_magnon_man.ogg",quiz:{question:"are you sure?",description:"can you tell me?",state:"published",answers:[{title:"yes",correct:!1,id:0},{title:"may be",correct:!0,id:1},{title:"who cares?",correct:!1,id:2},{title:"nope",correct:!1,id:3}]}}}},{index:1,name:"двунадесятыми праздниками",number:"2",image:"http://media.izi.travel/fc85dcc2-3e95-40a9-9a78-14705a106230/14845c98-05ec-4da8-8aff-11808ecc123f_800x600.jpg",thumb:"http://media.izi.travel/fc85dcc2-3e95-40a9-9a78-14705a106230/7104d8b7-2f73-4b98-bfb2-b4245a325ce3_480x360.jpg",publish_state:"all",description:"",qr_code:{url:"/img/qr_code.png",print_link:"http://localhost:8000/img/qr_code.png"},images:[{image:"http://media.izi.travel/fc85dcc2-3e95-40a9-9a78-14705a106230/14845c98-05ec-4da8-8aff-11808ecc123f_800x600.jpg",thumb:"http://media.izi.travel/fc85dcc2-3e95-40a9-9a78-14705a106230/7104d8b7-2f73-4b98-bfb2-b4245a325ce3_480x360.jpg",id:1,edit_url:"http://media.izi.travel/fc85dcc2-3e95-40a9-9a78-14705a106230/7104d8b7-2f73-4b98-bfb2-b4245a325ce3_480x360.jpg"},{image:"http://media.izi.travel/fc85dcc2-3e95-40a9-9a78-14705a106230/14845c98-05ec-4da8-8aff-11808ecc123f_800x600.jpg",thumb:"http://media.izi.travel/fc85dcc2-3e95-40a9-9a78-14705a106230/7104d8b7-2f73-4b98-bfb2-b4245a325ce3_480x360.jpg",id:2,edit_url:"http://media.izi.travel/fc85dcc2-3e95-40a9-9a78-14705a106230/7104d8b7-2f73-4b98-bfb2-b4245a325ce3_480x360.jpg"}],stories:{ru:{name:"Богоматерь Владимирская, с двунадесятыми праздниками",description:"test description",audio:"",publish_state:"all",quiz:{question:"are you sure?",description:"can you tell me?",state:"published",answers:[{title:"yes",correct:!1,id:0},{title:"may be",correct:!0,id:1},{title:"who cares?",correct:!1,id:2},{title:"nope",correct:!1,id:3}]}}}},{index:2,name:"Владимирская, с двунадесятыми",number:"3",image:"http://media.izi.travel/fc85dcc2-3e95-40a9-9a78-14705a106230/14845c98-05ec-4da8-8aff-11808ecc123f_800x600.jpg",thumb:"http://media.izi.travel/fc85dcc2-3e95-40a9-9a78-14705a106230/7104d8b7-2f73-4b98-bfb2-b4245a325ce3_480x360.jpg",statsu:"draft",publish_state:"all",description:"",qr_code:{url:"/img/qr_code.png",print_link:"http://localhost:8000/img/qr_code.png"},images:[{image:"http://media.izi.travel/fc85dcc2-3e95-40a9-9a78-14705a106230/14845c98-05ec-4da8-8aff-11808ecc123f_800x600.jpg",thumb:"http://media.izi.travel/fc85dcc2-3e95-40a9-9a78-14705a106230/7104d8b7-2f73-4b98-bfb2-b4245a325ce3_480x360.jpg",id:1,edit_url:"http://media.izi.travel/fc85dcc2-3e95-40a9-9a78-14705a106230/7104d8b7-2f73-4b98-bfb2-b4245a325ce3_480x360.jpg"},{image:"http://media.izi.travel/fc85dcc2-3e95-40a9-9a78-14705a106230/14845c98-05ec-4da8-8aff-11808ecc123f_800x600.jpg",thumb:"http://media.izi.travel/fc85dcc2-3e95-40a9-9a78-14705a106230/7104d8b7-2f73-4b98-bfb2-b4245a325ce3_480x360.jpg",id:2,edit_url:"http://media.izi.travel/fc85dcc2-3e95-40a9-9a78-14705a106230/7104d8b7-2f73-4b98-bfb2-b4245a325ce3_480x360.jpg"}],stories:{ru:{name:"Богоматерь Владимирская, с двунадесятыми праздниками",description:"test description",audio:"",publish_state:"all",quiz:{question:"are you sure?",description:"can you tell me?",state:"published",answers:[{title:"yes",correct:!1,id:0},{title:"may be",correct:!0,id:1},{title:"who cares?",correct:!1,id:2},{title:"nope",correct:!1,id:3}]}}}}]}),c.bind(e,"current_museum",{defaultValue:{language:"ru",def_lang:"ru",name:"Museum of modern art",index:2,number:3,image:"http://media.izi.travel/fc85dcc2-3e95-40a9-9a78-14705a106230/14845c98-05ec-4da8-8aff-11808ecc123f_800x600.jpg",thumb:"http://media.izi.travel/fc85dcc2-3e95-40a9-9a78-14705a106230/7104d8b7-2f73-4b98-bfb2-b4245a325ce3_480x360.jpg",publish_state:"all",description:"",qr_code:{url:"/img/qr_code.png",print_link:"http://localhost:8000/img/qr_code.png"},images:[{image:"http://media.izi.travel/fc85dcc2-3e95-40a9-9a78-14705a106230/14845c98-05ec-4da8-8aff-11808ecc123f_800x600.jpg",thumb:"http://media.izi.travel/fc85dcc2-3e95-40a9-9a78-14705a106230/7104d8b7-2f73-4b98-bfb2-b4245a325ce3_480x360.jpg",id:1,edit_url:"http://media.izi.travel/fc85dcc2-3e95-40a9-9a78-14705a106230/7104d8b7-2f73-4b98-bfb2-b4245a325ce3_480x360.jpg"},{image:"http://media.izi.travel/fc85dcc2-3e95-40a9-9a78-14705a106230/14845c98-05ec-4da8-8aff-11808ecc123f_800x600.jpg",thumb:"http://media.izi.travel/fc85dcc2-3e95-40a9-9a78-14705a106230/7104d8b7-2f73-4b98-bfb2-b4245a325ce3_480x360.jpg",id:2,edit_url:"http://media.izi.travel/fc85dcc2-3e95-40a9-9a78-14705a106230/7104d8b7-2f73-4b98-bfb2-b4245a325ce3_480x360.jpg"}],stories:{en:{name:"English",language:"en",publish_state:"all",quiz:{question:"are you sure?",description:"can you tell me?",state:"published",answers:[{title:"yes",correct:!1,id:0},{title:"may be",correct:!0,id:1},{title:"who cares?",correct:!1,id:2},{title:"nope",correct:!1,id:3}]}},es:{name:"Spanish",language:"es",publish_state:"all",quiz:{question:"are you sure?",description:"can you tell me?",state:"published",answers:[{title:"yes",correct:!1,id:0},{title:"may be",correct:!0,id:1},{title:"who cares?",correct:!1,id:2},{title:"nope",correct:!1,id:3}]}},ru:{name:"Russian",language:"ru",publish_state:"all",audio:"http://www.jplayer.org/audio/ogg/TSP-01-Cro_magnon_man.ogg",quiz:{question:"are you sure?",description:"can you tell me?",state:"published",answers:[{title:"yes",correct:!1,id:0},{title:"may be",correct:!0,id:1},{title:"who cares?",correct:!1,id:2},{title:"nope",correct:!1,id:3}]}}},new_story_link:"/1/1/1/"}}),e.work_museum=angular.copy(e.current_museum),u=$("#drop_down").removeClass("hidden").hide(),x=e.exhibits,g=h=0,v=x.length;v>h;g=++h)l=x[g],null!=l?(l.active=!1,l.selected=!1):e.exhibits.splice(g,1);return d=function(){return $("ul.exhibits li.exhibit.active")},e.dummy_focusout_process=function(){var t,i,a,r,n;if(""===u.find("#name").val()){for(i=!0,n=u.find("#media .form-control:not(#opas_number)"),a=0,r=n.length;r>a;a++)t=n[a],t=$(t),""!==t.val()&&(i=!1);return i?e.new_item_creation=!1:e.dummy_modal_open()}},e.closeDropDown=function(){var t;return t=d(),t.hasClass("dummy")&&e.dummy_focusout_process(t),u.hide(),t.removeClass("active")},e.attachDropDown=function(t){var i;return t=$(t),i=u.hasClass("inited"),u.show().insertAfter(r(t)),i?void 0:(u.addClass("inited"),u.find("a.done, .close").unbind("click").bind("click",function(t){return t.preventDefault(),e.closeDropDown()}),u.find(">.prev-ex").unbind("click").bind("click",function(e){var t,i;return e.preventDefault(),t=d(),i=t.prev(".exhibit"),("drop_down"===i.attr("id")||i.hasClass("dummy"))&&(i=i.prev()),i.length>0?i.find(".opener .description").click():t.siblings(".exhibit").last().find(".opener").click()}),u.find(">.next-ex").unbind("click").bind("click",function(e){var t,i;return e.preventDefault(),t=d(),i=t.next(),("drop_down"===i.attr("id")||i.hasClass("dummy"))&&(i=i.next()),i.length>0?i.find(".opener .description").click():t.siblings(".exhibit").first().find(".opener").click()}),$("#story_quiz_enabled, #story_quiz_disabled").unbind("change").bind("change",function(){var e,t;return e=$(this),t=u.find(".form-wrap"),"story_quiz_enabled"===e.attr("id")?($("label[for=story_quiz_enabled]").text("Enabled"),$("label[for=story_quiz_disabled]").text("Disable"),!0):($("label[for=story_quiz_disabled]").text("Disabled"),$("label[for=story_quiz_enabled]").text("Enable"),!0)}),u.find("a.delete_story").unbind("click").bind("click",function(t){var i;return i=$(this),i.hasClass("no_margin")?(t.preventDefault(),t.stopPropagation(),e.closeDropDown()):void 0}))},e.open_dropdown=function(t,i){var r,n,s,o,c,m,p,f;if(r=$(t.target).parents("li"),r.hasClass("active"))return e.closeDropDown(),!1;for(f=e.exhibits,m=0,p=f.length;p>m;m++)l=f[m],null!=l&&(l.active=!1);return i.active=!0,e.active_exhibit=i,c=d(),c.hasClass("dummy")&&e.dummy_focusout_process(c),c.removeClass("active"),r.addClass("active"),a(r,c)||(e.attachDropDown(r),setTimeout(function(){return $.scrollTo(r,500)},100)),s=u.find(".item_publish_settings"),n=u.find(".delete_story"),r.hasClass("dummy")?(o=r.data("number"),$("#opas_number").val(o).blur(),$("#name").focus(),s.hide(),n.addClass("no_margin")):(s.show(),n.removeClass("no_margin"))},e.museum_type_filter="",e.grid=function(){var e,t,i,a;return e=$(".exhibits>li.exhibit"),t=60,a=e.first().width(),i=40,n(e,a,i,t),$(window).resize(n.bind(this,e,a,i,t))},e.museum_list_prepare=function(){var e,t,i,a;return t=$("ul.museum_list"),e=t.find("li").length,a=$("body").width(),i=(150*e+160)/a,i>1?($(".museum_filters").show(),t.width(a-200)):($(".museum_filters").hide(),t.width(a-100))},setTimeout(function(){return e.museum_list_prepare(),initFileUpload()},200),e.active_exhibit=e.exhibits[0],angular.element(s).bind("resize",function(){return setTimeout(function(){return e.museum_list_prepare()},100)}),e.new_item_creation=!1,e.all_selected=!1,_=function(){return++e.exhibits[e.exhibits.length-1].number+1},m=function(){return++e.exhibits.length},p=function(){return e.current_museum.language},b=function(t){return t===e.current_museum.language?"passcode":"dummy"},f=function(t){return t===e.current_museum.language?"Экспонат_"+t:""},e.create_new_item=function(){var t,i;if(e.new_item_creation!==!0){e.new_exhibit={name:"",number:_(),index:m(),image:"/img/img-bg.png",thumb:"/img/img-bg.png",publish_state:"draft",description:"",qr_code:{url:"",print_link:""},images:[{image:"/img/img-bg.png",thumb:"/img/img-bg.png"}],stories:{}};for(i in e.current_museum.stories)e.new_exhibit.stories[i]={name:"",description:"",audio:"",publish_stat:"passcode",quiz:{question:"",description:"",state:"limited",answers:[{title:"",correct:!0,id:0},{title:"",correct:!1,id:1},{title:"",correct:!1,id:2},{title:"",correct:!1,id:3}]}};return e.new_item_creation=!0,t={},t.target=$("li.exhibit.dummy > .opener.draft"),e.open_dropdown(t,e.new_exhibit),$(window).resize(),e.exhibits.splice(e.exhibits.length-1,1)}},e.modal_options={current_language:{name:"Russian",language:"ru"},languages:e.current_museum.stories},e.check_selected=function(){var t,i,a,r;for(t=0,e.select_all_enabled=!1,r=e.exhibits,i=0,a=r.length;a>i;i++)l=r[i],l.selected===!0&&(e.select_all_enabled=!0,t+=1);return t===e.exhibits.length?e.all_selected=!0:void 0},e.select_all_exhibits=function(){var t,i,a,r;for(t=!e.all_selected,r=e.exhibits,i=0,a=r.length;a>i;i++)l=r[i],l.selected=t;return e.all_selected=!e.all_selected,e.select_all_enabled=t},e.delete_modal_open=function(){var t;return t=o.open({templateUrl:"myModalContent.html",controller:ModalDeleteInstanceCtrl,resolve:{modal_options:function(){return e.modal_options}}}),t.result.then(function(t){var i,a,r,n,s,o,c,u,d;if(e.selected=t,Object.keys(e.active_exhibit.stories).length===t.length||1===Object.keys(e.active_exhibit.stories).length){for(e.closeDropDown(),o=e.exhibits,u=[],g=n=0,s=o.length;s>n;g=++n){if(l=o[g],l.index===e.active_exhibit.index){e.exhibits.splice(g,1),e.active_exhibit=e.exhibits[0];break}u.push(void 0)}return u}c=e.active_exhibit.stories,d=[];for(a in c)r=c[a],d.push(function(){var r,n,s;for(s=[],r=0,n=t.length;n>r;r++)i=t[r],i===a?s.push(e.active_exhibit.stories[a]={language:p(),name:"",description:"",audio:"",quiz:{question:"",description:"",answers:[{title:"",correct:!0,id:0},{title:"",correct:!1,id:1},{title:"",correct:!1,id:2},{title:"",correct:!1,id:3}]}}):s.push(void 0);return s}());return d},function(){return console.log("Modal dismissed at: "+new Date)})},e.dummy_modal_open=function(){var t;return t=o.open({templateUrl:"myDummyModalContent.html",controller:ModalDummyInstanceCtrl,resolve:{modal_options:function(){return{exhibit:e.active_exhibit}}}}),t.result.then(function(t){return e.new_item_creation=!1,e.item_deletion=!0,"save_as"===t?(e.new_exhibit.stories[e.current_museum.language].name="item_"+e.new_exhibit.number,e.new_exhibit.stories[e.current_museum.language].publish_state="passcode",e.new_exhibit.active=!1,e.exhibits.push(e.new_exhibit)):(e.closeDropDown(),e.new_exhibit.active=!1,e.active_exhibit=e.exhibits[0]),e.item_deletion=!1},function(){return console.log("Modal dismissed at: "+new Date)})},e.show_museum_edit=function(t){var i;return i=$(t.target),$(".navigation .museum_edit, .page .museum_edit_guaranter").slideToggle(1e3,"easeOutQuint"),i.find("i").toggleClass("icon-chevron-down icon-chevron-up"),e.museum_edit_dropdown_opened=!e.museum_edit_dropdown_opened,!1},e.museum_edit_dropdown_close=function(){return setTimeout(function(){return $(".actions_bar .museum_edit_opener").click()},10)},e.$on("save_new_exhibit",function(){var t,i,a;console.log("saving!"),e.new_exhibit.publish_state="passcode",a=e.new_exhibit.stories;for(t in a)i=a[t],i.publish_state="passcode";return e.exhibits.push(e.new_exhibit),e.new_item_creation=!1}),e.populate_localstorage=function(){var t,i,a,r,n,s,o;for(s=e.exhibits,a=0,n=s.length;n>a;a++){l=s[a];for(i in e.current_museum.stories)null==l.stories[i]&&(l.stories[i]={language:i,name:"",description:"",audio:"",publish_state:"dummy",quiz:{question:"",description:"",state:"",answers:[{title:"",correct:!1,id:0},{title:"",correct:!0,id:1},{title:"",correct:!1,id:2},{title:"",correct:!1,id:3}]}})}for(o=[],t=r=0;22>=r;t=++r){l={index:e.exhibits[e.exhibits.length-1].index+2,name:"Экспонат",number:e.exhibits[e.exhibits.length-1].index+2,image:"http://media.izi.travel/fc85dcc2-3e95-40a9-9a78-14705a106230/14845c98-05ec-4da8-8aff-11808ecc123f_800x600.jpg",thumb:"http://media.izi.travel/fc85dcc2-3e95-40a9-9a78-14705a106230/7104d8b7-2f73-4b98-bfb2-b4245a325ce3_480x360.jpg",description:"",qr_code:{url:"/img/qr_code.png",print_link:"http://localhost:8000/img/qr_code.png"},images:[{image:"http://media.izi.travel/fc85dcc2-3e95-40a9-9a78-14705a106230/14845c98-05ec-4da8-8aff-11808ecc123f_800x600.jpg",thumb:"http://media.izi.travel/fc85dcc2-3e95-40a9-9a78-14705a106230/7104d8b7-2f73-4b98-bfb2-b4245a325ce3_480x360.jpg",id:1,edit_url:"http://media.izi.travel/fc85dcc2-3e95-40a9-9a78-14705a106230/7104d8b7-2f73-4b98-bfb2-b4245a325ce3_480x360.jpg"},{image:"http://media.izi.travel/fc85dcc2-3e95-40a9-9a78-14705a106230/14845c98-05ec-4da8-8aff-11808ecc123f_800x600.jpg",thumb:"http://media.izi.travel/fc85dcc2-3e95-40a9-9a78-14705a106230/7104d8b7-2f73-4b98-bfb2-b4245a325ce3_480x360.jpg",id:2,edit_url:"http://media.izi.travel/fc85dcc2-3e95-40a9-9a78-14705a106230/7104d8b7-2f73-4b98-bfb2-b4245a325ce3_480x360.jpg"}]},l.stories={};for(i in e.current_museum.stories)l.stories[i]={language:i.language,name:f(i),description:"test description",audio:"",publish_state:b(i),quiz:{question:"are you sure?",description:"can you tell me?",state:"limited",answers:[{title:"yes",correct:!1,id:0},{title:"may be",correct:!0,id:1},{title:"who cares?",correct:!1,id:2},{title:"nope",correct:!1,id:3}]}};o.push(e.exhibits.push(l))}return o}}]).controller("DropDownController",["$scope","$http","$filter","$window","$modal","storage","$rootScope",function(e,t,i,a,r,n,s){return e.quiz_state=function(t){return e.mark_quiz_validity(t.$valid),t.$valid||setTimeout(function(){return $("#story_quiz_disabled").click()},300),!0},e.mark_quiz_validity=function(e){var t;return t=$("#quiz form"),e?t.removeClass("has_error"):t.addClass("has_error"),!0},e.$watch("$parent.active_exhibit.stories[$parent.current_museum.language].quiz",function(t){if("limited"===t.state){if(!$("#story_quiz_disabled").is(":checked"))return setTimeout(function(){return $("#story_quiz_disabled").click()},10)}else if("published"===t.state)return $("#story_quiz_enabled").is(":checked")?setTimeout(function(){return e.quizform.$valid?void 0:setTimeout(function(){return $("#story_quiz_disabled").click()},10)},100):setTimeout(function(){return $("#story_quiz_enabled").click()},10)},!0),e.$watch("$parent.active_exhibit.stories[$parent.current_museum.language].quiz.question",function(){return null!=e.quizform?e.quizform.$valid?e.mark_quiz_validity(e.quizform.$valid):setTimeout(function(){return $("#story_quiz_disabled").click(),e.mark_quiz_validity(e.quizform.$valid)},10):void 0}),e.$watch("$parent.active_exhibit.stories[$parent.current_museum.language].name",function(t,i){var a;if(a=$("#media form"),a.length>0)if("dummy"===e.$parent.active_exhibit.stories[e.$parent.current_museum.language].publish_state){if(t)return e.$parent.active_exhibit.stories[e.$parent.current_museum.language].publish_state="passcode"}else if(e.$parent.new_item_creation||e.$parent.item_deletion){if(t&&e.$parent.new_item_creation)return s.$broadcast("save_new_exhibit")}else if(!t)return e.$parent.active_exhibit.stories[e.$parent.current_museum.language].name=i,$(".empty_name_error.name").show(),setTimeout(function(){return $(".empty_name_error.name").hide()},1500)}),e.$watch("$parent.active_exhibit.number",function(t,i){var a;return a=$("#media form"),a.length>0&&!e.$parent.new_item_creation&&!e.$parent.item_deletion&&!t?(e.$parent.active_exhibit.number=i,$(".empty_name_error.number").show(),setTimeout(function(){return $(".empty_name_error.number").hide()},1500)):void 0}),e.$watch(function(){return angular.toJson(e.$parent.active_exhibit.stories[e.$parent.current_museum.language].quiz.answers)},function(){return null!=e.quizform?e.quizform.$valid?e.mark_quiz_validity(e.quizform.$valid):setTimeout(function(){return $("#story_quiz_disabled").click()},10):void 0},!0),e.upload_image=function(e){var t,i;return e.preventDefault(),t=$(e.target),i=t.parents("#images, #maps"),i.find("li:hidden").isEmpty()&&$.ajax({url:t.attr("href"),async:!1,success:function(a){var r;return r=$(a).hide(),i.find("li.new").before(r),initFileUpload(e,r.find(".fileupload"),{progress:t.find(".progress")})}}),i.find("li:hidden :file").click()},e.delete_image=function(e){var t,i;return e.preventDefault(),e.stopPropagation(),t=$(e.target),i=t.parents("#images, #maps"),confirm(t.data("confirm"))?$.ajax({url:t.attr("href"),type:t.data("method"),data:{authentity_token:$("meta[name=csrf-token]").attr("content")},success:function(){var e;return e=200,i.attr("id").match(/images/)?t.parents("li").fadeOut(e,function(){return t.remove(),storySetImage.trigger("image:deleted")}):t.parents("li").fadeOut(e,function(){return t.remove()})}}):void 0},e.change_image=function(e){var t,i;return t=$(e.target),i=t.parents("form"),t.hasClass("disabled")?void 0:i.find(":file").trigger("click")},!0}]).controller("MuseumEditController",["$scope","$http","$filter","$window","$modal","storage",function(e){return e.museum_quiz_state=function(t){return e.mark_quiz_validity(t.$valid),t.$valid||setTimeout(function(){return $("#museum_story_quiz_disabled").click()},300),!0},e.mark_quiz_validity=function(e){var t;return t=$("#museum_quiz form"),e?t.removeClass("has_error"):t.addClass("has_error"),!0},e.$watch("$parent.current_museum.stories[$parent.current_museum.language].quiz",function(t){if("limited"===t.state){if(!$("#museum_story_quiz_disabled").is(":checked"))return setTimeout(function(){return $("#museum_story_quiz_disabled").click()},10)}else if("published"===t.state)return $("#museum_story_quiz_enabled").is(":checked")?setTimeout(function(){return e.museumQuizform.$valid?void 0:setTimeout(function(){return $("#museum_story_quiz_disabled").click()},10)},100):setTimeout(function(){return $("#museum_story_quiz_enabled").click()},10)},!0),e.$watch("$parent.current_museum.stories[$parent.current_museum.language].quiz.question",function(){return null!=e.museumQuizform?e.museumQuizform.$valid?e.mark_quiz_validity(e.museumQuizform.$valid):setTimeout(function(){return $("#story_quiz_disabled").click(),e.mark_quiz_validity(e.museumQuizform.$valid)},10):void 0}),e.$watch(function(){return angular.toJson(e.$parent.current_museum.stories[e.$parent.current_museum.language].quiz.answers)},function(){return null!=e.museumQuizform?e.museumQuizform.$valid?e.mark_quiz_validity(e.museumQuizform.$valid):setTimeout(function(){return $("#museum_#story_quiz_disabled").click()},10):void 0},!0),!0}]),this.ModalDeleteInstanceCtrl=function(e,t,i){return e.modal_options=i,e.only_one=1===e.modal_options.languages.length,e.ok=function(){var i,a,r;e.selected=[],r=e.modal_options.languages;for(i in r)a=r[i],a.checked===!0&&e.selected.push(i);return t.close(e.selected)},e.cancel=function(){return t.dismiss()},e.mark_all=function(){var t,i,a,r;a=e.modal_options.languages,r=[];for(t in a)i=a[t],r.push(i.checked=!0);return r},e.mark_default_only=function(){var t,i,a,r;a=e.modal_options.languages,r=[];for(t in a)i=a[t],i.checked=!1,e.modal_options.current_language.language===t?r.push(i.checked=!0):r.push(void 0);return r},e.mark_default_only()},this.ModalDummyInstanceCtrl=function(e,t,i){return e.exhibit=i.exhibit,e.discard=function(){return t.close("discard")},e.save_as=function(){return t.close("save_as")}}}).call(this);