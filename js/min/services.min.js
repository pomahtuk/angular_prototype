(function(){"use strict";angular.module("Museum.services",[]).service("sharedProperties",function(r){var t;return t={},{getProperty:function(r){return t[r]},setProperty:function(e,n){return t[e]=n,r.$broadcast("exhibitChange")}}}).service("storySetValidation",function(r,t){return{checkValidity:function(t){return null==t.item.images&&(t.item.images=[]),null==t.item.long_description&&(t.item.long_description=""),0!==t.item.long_description.length&&t.item.audio&&null!=t.root.number&&t.root.images.length>=1?(this.markValid(t),r.$broadcast("changes_to_save",t)):this.markInvalid(t)},markInvalid:function(e){return console.log("invalid"),"published"===e.item.status?(e.root.invalid=!0,t(function(){return e.item.status="passcode",null!=e.$digest&&e.$digest(),r.$broadcast("changes_to_save",e)},100)):r.$broadcast("changes_to_save",e)},markValid:function(r){return console.log("valid"),r.root.invalid=!1}}}).service("imageMappingHelpers",function(r,t,e,n){var i;return i=function(t){var e;return e=0,e+=t.image.order,null!=t.mappings[r.lang]&&(e-=100),e},{sort_weight_func:function(r,t){return i(r)>i(t)?1:i(r)<i(t)?-1:0},sort_time_func:function(t,e){if(null!=t.mappings[r.lang]&&null!=e.mappings[r.lang]&&t.mappings[r.lang].timestamp>=0){if(t.mappings[r.lang].timestamp>e.mappings[r.lang].timestamp)return 1;if(t.mappings[r.lang].timestamp<e.mappings[r.lang].timestamp)return-1}return 0},calc_timestamp:function(r,t){var e,n,i,o,s,a,u,l,c;return null==t&&(t=!1),l=$(".jp-seek-bar:visible"),s=$(".jp-duration:visible"),a=$(".jp-play:visible"),n=t?r.offset.left-l.offset().left:r.position.left-a.width(),e=l.width()-15,o=s.text(),c=parseInt(o.split(":")[1],10)+60*parseInt(o.split(":")[0],10),u=c/e,i=Math.round(n*u),0>=i&&(i=0),i},update_image:function(i,o){return e.put(""+o+"/media/"+i.image._id,i.image).success(function(){var s;return console.log("ok"),null!=i.mappings[r.lang]&&(s=i.mappings[r.lang],null!=s._id)?e.put(""+o+"/media_mapping/"+s._id,s).success(function(){return console.log("ok")}).error(function(){return t.addError(n("Failed to set timestamp"))}):void 0}).error(function(){return t.addError(n("Failed to set timestamp"))}),!0},update_images:function(r,i,o){return e.post(""+o+"/media_for/"+r+"/reorder",i).success(function(){return console.log("ok")}).error(function(){return t.addError(n("Failed to update order"))}),!0},create_mapping:function(i,o){return e.post(""+o+"/media_mapping/",i.mappings[r.lang]).success(function(t){return i.mappings[r.lang]=t}).error(function(){return t.addError(n("Failed to set timestamp"))}),!0}}}).service("errorProcessing",function(r){return{errors:[],addError:function(t){var e;return e={error:t},this.errors.push(e),r.$broadcast("new_error",this.errors)},getErrors:function(){return this.errors},clearErrors:function(){return this.errors=[],r.$broadcast("new_error",this.errors)},deleteError:function(t){return this.errors.splice(t,1),r.$broadcast("new_error",this.errors)}}})}).call(this);