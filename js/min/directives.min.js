(function(){"use strict";angular.module("Museum.directives",[]).directive("ngBlur",function(){return function(e,n,t){return n.bind("blur",function(){return e.$apply(t.ngBlur)})}}).directive("ngFocus",function(e){return function(n,t,i){return n.$watch(i.ngFocus,function(n){return n?e(function(){return t[0].focus()},0,!1):void 0})}}).directive("focusMe",function(e,n){return{link:function(t,i,s){var r;return r=n(s.focusMe),t.$watch(r,function(n){return n===!0?e(function(){return i[0].focus()}):void 0}),i.bind("blur",function(){return t.$apply(r.assign(t,!1))})}}}).directive("stopEvent",function(){return{link:function(e,n,t){return n.bind(t.stopEvent,function(e){return e.stopPropagation()})}}}).directive("resizer",function(){return{restrict:"A",link:function(e,n){var t;return t=$(n),t.focus(function(){return t.animate({width:"+=150"},200)}),t.blur(function(){return t.animate({width:"-=150"},200)})}}}).directive("toggleMenu",function(){return{restrict:"A",link:function(e,n){var t;return t=$(n),t.click(function(){return $(".navigation").toggleClass("navbar-fixed-top"),$(".museum_navigation_menu").slideToggle(300),$("body").toggleClass("fixed_navbar"),setTimeout(function(){return $.scrollTo(0,0)},0)})}}}).directive("toggleFilters",function(){return{restrict:"A",link:function(e,n){var t;return t=$(n),t.click(function(){return $(".filters_bar").slideToggle(200),setTimeout(function(){return $("body").toggleClass("filers")},100)})}}}).directive("postRender",function(e){return{restrict:"A",link:function(n){return n.$last&&e(n.grid,0),!0}}}).directive("switchpubitem",function(){return{restrict:"E",replace:!0,transclude:!0,require:"?ngModel",scope:{item:"=ngItem",provider:"=ngProvider",current_museum:"=ngMuseum",trans:"=translations"},template:'<div class="btn-group pull-right item_publish_settings">\n  <button class="btn btn-success dropdown-toggle" data-toggle="dropdown" type="button" ng-switch on="item.stories[current_museum.language].publish_state">\n    <div class="extra" ng-switch on="item.stories[current_museum.language].publish_state">\n      <i class="icon-globe" ng-switch-when="all" ></i>\n      <i class="icon-user" ng-switch-when="passcode" ></i>\n    </div>\n    <span ng-switch-when="passcode">Publish</span>\n    <span ng-switch-when="all">Published</span>\n    <span class="caret"></span>\n  </button>\n  <ul class="dropdown-menu status-select-dropdown" role="menu">\n    Who can see it in mobile application\n    <li class="divider"></li>\n    <li ng-click="item.stories[current_museum.language].publish_state = \'all\'">\n      <i class="icon-globe"></i> Everyone\n      <span class="check" ng-show="item.stories[current_museum.language].publish_state == \'all\'">✓</span>\n    </li>\n    <li  ng-click="item.stories[current_museum.language].publish_state = \'passcode\'">\n      <i class="icon-user"></i> Only users who have passcode\n      <span class="check" ng-show="item.stories[current_museum.language].publish_state == \'passcode\'">✓</span>\n      <div class="limited-pass-hint hidden">\n        <div class="limited-pass">\n          {{provider.passcode}}\n        </div>\n        <a href="{{provider.passcode_edit_link}}" target="_blank">Edit</a>\n      </div>\n    </li>\n    <li class="divider"></li>\n    <li class="other_list">\n      <span class="other_lang" ng-click="hidden_list=!hidden_list" stop-event="click">Other languages</a>\n      <ul class="other" ng-hide="hidden_list">\n        <li ng-repeat="(name, story) in item.stories" ng-switch on="story.publish_state">\n          <span class="col-lg-4">{{trans[name]}} </span>\n          <i class="icon-globe" ng-switch-when="all" ></i>\n          <i class="icon-user" ng-switch-when="passcode" ></i>\n        </li>\n      </ul>\n    </li>\n  </ul>\n</div>',link:function(e){return e.hidden_list=!0,!0}}}).directive("switchpub",function(){return{restrict:"E",replace:!0,transclude:!0,require:"?ngModel",scope:{item:"=ngItem",provider:"=ngProvider"},template:'<div class="btn-group">\n  <button class="btn btn-default dropdown-toggle" data-toggle="dropdown" type="button">\n    <div class="extra_right" ng-switch on="item.publish_state">\n      <i class="icon-globe" ng-switch-when="all" ></i>\n      <i class="icon-user" ng-switch-when="passcode" ></i>\n    </div>\n    <span class="caret"></span></button>\n  <ul class="dropdown-menu" role="menu">\n    Who can see it in mobile application\n    <li class="divider"></li>\n    <li  ng-click="item.publish_state = \'all\'">\n      <i class="icon-globe"></i> Everyone\n      <span class="check" ng-show="item.publish_state == \'all\'">✓</span>\n    </li>\n    <li ng-click="item.publish_state = \'passcode\'">\n      <i class="icon-user"></i> Only users who have passcode\n      <span class="check" ng-show="item.publish_state == \'passcode\'">✓</span>\n      <div class="limited-pass-hint hidden">\n        <div class="limited-pass">\n          {{provider.passcode}}\n        </div>\n        <a href="{{provider.passcode_edit_link}}" target="_blank">Edit</a>\n      </div>\n    </li>\n  </ul>\n</div>',link:function(){return!0}}}).directive("placeholderfield",function(){return{restrict:"E",replace:!0,require:"?ngModel",scope:{item:"=ngItem",help:"@ngHelp",id:"@ngId",title:"@ngTitle",field:"@ngField",inv_sign:"=invalidsign"},template:'<div class="form-group">\n  <label class="col-xs-2 control-label" for="{{id}}" ng-click="edit_mode = false">{{title}}</label>\n  <div class="help" popover="{{help}}" popover-placement="bottom" popover-animation="true" popover-trigger="mouseenter">\n    <i class="icon-question-sign"></i>\n  </div>\n  <span class="empty_name_error" ng-show="field == \'name\'">can\'t be empty</span>\n  <div class="col-xs-6 trigger" ng-hide="edit_mode || empty_val">\n    <span class="placeholder" ng-click="edit_mode = true">{{item[field]}}</span>\n  </div>\n  <div class="col-xs-6 triggered" ng-show="edit_mode || empty_val">\n    <input class="form-control" id="{{id}}" ng-model="item[field]" focus-me="edit_mode" type="text" ng-blur="status_process()" required>\n    <div class="error_text" ng-show="field==\'name\' || field==\'question\'">can\'t be blank</div>\n  </div>\n  <status-indicator ng-binding="status"></statusIndicator>\n</div>',controller:function(e){return null==e.item.statuses&&(e.item.statuses={}),e.status=e.item.statuses[e.item.field],e.status_process=function(){return e.item[e.field]&&0!==e.item[e.field].length?(e.status="progress",e.empty_val=!1,e.edit_mode=!1):e.empty_val=!0}},link:function(e){return e.edit_mode=!1,e.$watch("item[field]",function(n){return e.empty_val=n?!1:!0}),e.$watch("inv_sign",function(n){return n===!0?setTimeout(function(){return e.name_error=!1,console.log(e.name_error)},1e3):e.empty_val=!1}),!0}}}).directive("placeholdertextarea",function(){return{restrict:"E",replace:!0,require:"?ngModel",scope:{item:"=ngItem",help:"@ngHelp",id:"@ngId",title:"@ngTitle",field:"@ngField",max_length:"@maxlength"},template:'<div class="form-group">\n  <label class="col-xs-2 control-label" for="{{id}}" ng-click="edit_mode = false">{{title}}</label>\n  <div class="help" popover="{{help}}" popover-placement="bottom" popover-animation="true" popover-trigger="mouseenter">\n    <i class="icon-question-sign"></i>\n  </div>\n  <span class="sumbols_left" ng-hide="status == \'progress\' || status == \'done\' || empty_val || !edit_mode ">\n    {{length_text}}\n  </span>\n  <div class="col-lg-6 trigger" ng-hide="edit_mode || empty_val">\n    <span class="placeholder large" ng-click="edit_mode = true">{{item[field]}}</span>\n  </div>\n  <div class="col-lg-6 triggered" ng-show="edit_mode || empty_val">\n    <textarea class="form-control" id="{{id}}" focus-me="edit_mode" ng-model="item[field]" ng-blur="status_process()" required>\n    </textarea>\n  </div>\n  <status-indicator ng-binding="status"></statusIndicator>\n</div>',controller:function(e){return null==e.item.statuses&&(e.item.statuses={}),e.status=e.item.statuses[e.item.field],e.status_process=function(){return e.item[e.field]&&0!==e.item[e.field].length?(e.status="progress",e.empty_val=!1,e.edit_mode=!1):e.empty_val=!0}},link:function(e){return e.length_text="осталось символов: 255",e.edit_mode=!1,e.$watch("item[field]",function(n){return n?(e.empty_val=!1,e.max_length||(e.max_length=255),e.length_text="осталось символов: "+(e.max_length-n.length-1),n.length>=e.max_length?e.item[e.field]=n.substr(0,e.max_length-1):void 0):(e.empty_val=!0,e.length_text="осталось символов: 255")}),!0}}}).directive("quizanswer",function(){return{restrict:"E",replace:!0,require:"?ngModel",scope:{item:"=ngItem",collection:"=ngCollection",id:"@ngId"},template:'<div class="form-group string optional checkbox_added">\n  <label class="string optional control-label col-xs-2" for="{{id}}">\n    <span class=\'correct_answer_indicator\' ng-show="item.correct_saved">correct</span>\n  </label>\n  <input class="coorect_answer_radio" name="correct_answer" type="radio" value="{{item.id}}" ng-model="checked" ng-click="check_items(item)">\n  <div class="col-xs-5 trigger" ng-hide="edit_mode || empty_val">\n    <span class="placeholder" ng-click="edit_mode = true">{{item.title}}</span>\n  </div>\n  <div class="col-xs-5 triggered" ng-show="edit_mode || empty_val">\n    <input class="form-control" id="{{id}}" name="{{item.id}}" placeholder="Enter option" type="text" ng-model="item.title" focus-me="edit_mode" ng-blur="status_process()" required>\n    <div class="error_text">can\'t be blank</div>\n  </div>\n  <status-indicator ng-binding="status"></statusIndicator>\n</div>',controller:function(e){return null==e.item.statuses&&(e.item.statuses={}),e.status=e.item.statuses[e.item.title],null==e.item.correct_saved&&(e.item.correct_saved=!1),e.check_items=function(n){var t,i,s,r;for(r=e.collection,i=0,s=r.length;s>i;i++)t=r[i],t.correct=!1,t.correct_saved=!1;return n.correct=!0,e.item.correct_saved=!0},e.status_process=function(){return e.item.title&&0!==e.item.title.length?(e.status="progress",e.empty_val=!1,e.edit_mode=!1):e.empty_val=!0}},link:function(e){return e.edit_mode=!1,e.empty_val=!1,e.checked=0,e.$watch("collection",function(n){var t,i,s,r;if(n){for(r=[],i=0,s=n.length;s>i;i++)t=n[i],t.correct===!0?r.push(e.checked=t.id):r.push(void 0);return r}}),e.$watch("item.title",function(n){return n?e.empty_val=!1:(e.edit_mode=!0,e.empty_val=!0)}),e.$watch("item.correct_saved",function(n){return n===!0?setTimeout(function(){return e.$apply(e.item.correct_saved=!1)},1e3):void 0},!0)}}}).directive("statusIndicator",function(){return{restrict:"E",replace:!0,require:"?ngModel",scope:{item:"=ngBinding",field:"=ngField"},template:'<div class="statuses">\n  <div class=\'preloader\' ng-show="item==\'progress\'"></div>\n  <div class="save_status" ng-show="item==\'done\'">\n    <i class="icon-ok-sign"></i>saved\n  </div>\n</div>',link:function(e){return e.$watch("item",function(n){return n&&("progress"===n&&setTimeout(function(){return e.$apply(e.item="done")},500),"done"===n)?setTimeout(function(){return e.$apply(e.item="")},700):void 0},!0)}}}).directive("audioplayer",function(){return{restrict:"E",replace:!0,require:"?ngModel",scope:{item:"=ngItem",help:"@ngHelp",id:"@ngId",title:"@ngTitle",field:"@ngField"},template:'<div class="form-group">\n  <label class="col-xs-2 control-label" for="audio">Audio</label>\n  <div class="help">\n    <i class="icon-question-sign" data-content="Supplementary field. You may indicate the exhibit’s inventory, or any other number, that will help you to identify the exhibit within your own internal information system." data-placement="bottom"></i>\n  </div>\n  <div class="col-xs-6 trigger" ng-hide="edit_mode">\n    <div class="jp-jplayer" id="jquery_jplayer_1">\n    </div>\n    <div class="jp-audio" id="jp_container_1">\n      <div class="jp-type-single">\n        <div class="jp-gui jp-interface">\n          <ul class="jp-controls">\n            <li>\n            <a class="jp-play" href="javascript:;" tabindex="1"></a>\n            </li>\n            <li>\n            <a class="jp-pause" href="javascript:;" tabindex="1"></a>\n            </li>\n          </ul>\n        </div>\n        <div class="dropdown">\n          <a data-toggle="dropdown" href="#" id="visibility_filter">Audioguide 01<span class="caret"></span></a>\n          <ul aria-labelledby="visibility_filter" class="dropdown-menu" role="menu">\n            <li role="presentation">\n            <a href="#" role="menuitem" tabindex="-1">Replace</a>\n            </li>\n            <li role="presentation">\n            <a href="#" role="menuitem" tabindex="-1">Download</a>\n            </li>\n          </ul>\n        </div>\n        <div class="jp-progress">\n          <div class="jp-seek-bar">\n            <div class="jp-play-bar">\n            </div>\n          </div>\n        </div>\n        <div class="jp-time-holder">\n          <div class="jp-current-time">\n          </div>\n          <div class="jp-duration">\n          </div>\n        </div>\n        <div class="jp-no-solution">\n          <span>Update Required</span>To play the media you will need to either update your browser to a recent version or update your browser to a recent version or update your <a href="http://get.adobe.com/flashplayer/" target="_blank"></a>\n        </div>\n      </div>\n    </div>\n  </div>\n  <div class="col-xs-6 triggered" ng-show="edit_mode">\n    <input type="file" id="exampleInputFile">\n  </div>\n  <status-indicator ng-binding="item" ng-field="field"></statusIndicator>\n</div>',link:function(e){return e.edit_mode=!1,$("#jquery_jplayer_1").jPlayer({swfPath:"/js",wmode:"window",preload:"auto",smoothPlayBar:!0,keyEnabled:!0,supplied:"m4a, oga"}),e.$watch("item[field]",function(n){return n?(e.edit_mode=!1,console.log($("#jquery_jplayer_1")),$("#jquery_jplayer_1").jPlayer("setMedia",{m4a:n,oga:n})):e.edit_mode=!0}),!0}}}).directive("museumSearch",function(){return{restrict:"E",replace:!0,transclude:!0,require:"?ngModel",scope:{item:"=ngModel"},template:'<div class="searches">\n  <div class="search" ng-hide="museum_search_visible" ng-click="museum_search_visible=true; museum_input_focus = true">\n    <i class="icon-search"></i>\n    <a href="#">{{item || \'Search\'}}</a>\n  </div>\n  <div class="search_input" ng-show="museum_search_visible">\n    <input class="form-control" ng-model="item" placeholder="Search" type="text" focus-me="museum_input_focus">\n    <a class="search_reset" href="#" ng-click="item=\'\'">\n      <i class="icon-remove-sign"></i>\n    </a>\n  </div>\n</div>',controller:function(e,n){return e.museum_search_visible=!1,e.museum_input_focus=!1,$(n).find(".search_input input").blur(function(){var n;return n=$(this),e.$apply(e.museum_input_focus=!1),n.animate({width:"150px"},150,function(){return e.$apply(e.museum_search_visible=!1),!0})}),$(n).find(".search_input input").focus(function(){var e,n;return e=$(this),n=$("body").width()-700,n>150?e.animate({width:""+n+"px"},300):void 0})},link:function(){return!0}}})}).call(this);